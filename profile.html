<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles/profile.css" />
    <title>Contact.com â€“ Profile</title>
</head>

<body>

<nav class="navbar">
    <div class="hamburger" onclick="toggleMenu()">
        <span></span><span></span><span></span>
    </div>

    <div class="logo">Contact<span>.</span>com</div>

    <div class="nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="communities.html">Communities</a>
        <a href="events.html">Events</a>
        <a href="profile.html">Profile</a>
        <a href="#" onclick="logout()">Logout</a>
    </div>
</nav>

<!-- HERO -->
<div class="hero">
    <h1 id="fullNameDisplay">Your Name</h1>
    <p id="professionDisplay">Your profession or tagline</p>
</div>

<!-- EDITABLE SECTIONS -->
<div class="section">
    <h2>Full Name</h2>
    <input id="fullName" disabled />
</div>

<div class="section">
    <h2>Profession</h2>
    <input id="profession" disabled />
</div>

<div class="section">
    <h2>About Me</h2>
    <textarea id="about" rows="5" disabled></textarea>
</div>

<div class="section">
    <h2>Skills</h2>
    <input id="skills" disabled />
</div>

<div class="section">
    <h2>Work & Life</h2>
    <textarea id="workLife" rows="5" disabled></textarea>
</div>

<!-- CHANGE EMAIL -->
<div class="section">
    <h2>Change Email</h2>
    <input id="newEmail" type="email" placeholder="Enter new email" />
    <button onclick="changeEmail()">Update Email</button>
</div>

<!-- CHANGE PASSWORD -->
<div class="section">
    <h2>Change Password</h2>
    <input id="newPassword" type="password" placeholder="New password" />
    <input id="confirmPassword" type="password" placeholder="Confirm password" style="margin-top:10px;" />
    <button onclick="changePassword()">Update Password</button>
</div>

<!-- ACTION BUTTONS -->
<div class="section" style="text-align:center;">
    <button class="edit-btn" id="editBtn" onclick="enableEditing()">Edit Profile</button>
    <button id="saveBtn" onclick="saveProfile()" style="display:none;">Save Changes</button>
</div>

</body>
</html>

<script>
/* REAL WEB APP URL */
const API_URL = "https://script.google.com/macros/s/AKfycbxH8gxO-udSGq71pi8M2Te6GSxz_QyNH5d9-Z9C1do-kUr5j14ukxrgneUIViMlg-vj/exec";

/* NAV MENU */
function toggleMenu() {
    document.querySelector('.nav-links').classList.toggle('show');
}

/* LOAD PROFILE */
document.addEventListener("DOMContentLoaded", loadProfile);

function loadProfile() {
    const user = JSON.parse(localStorage.getItem("contact_user"));
    if (!user) return window.location.href = "login.html";

    // Safe DOM access
    setValue("fullNameDisplay", user.fullName);
    setValue("professionDisplay", user.profession || "Your profession");

    setInput("fullName", user.fullName);
    setInput("profession", user.profession);
    setInput("about", user.about);
    setInput("skills", user.skills);
    setInput("workLife", user.workLife);
}

/* SAFE HELPERS */
function setValue(id, value) {
    const el = document.getElementById(id);
    if (el) el.innerText = value;
}

function setInput(id, value) {
    const el = document.getElementById(id);
    if (el) el.value = value || "";
}

/* ENABLE EDITING */
function enableEditing() {
    document.querySelectorAll("#fullName, #profession, #about, #skills, #workLife")
        .forEach(el => el.disabled = false);

    setDisplay("saveBtn", "inline-block");
    setDisplay("editBtn", "none");
}

function setDisplay(id, value) {
    const el = document.getElementById(id);
    if (el) el.style.display = value;
}

/* SAVE PROFILE (GET ONLY) */
async function saveProfile() {
    const user = JSON.parse(localStorage.getItem("contact_user"));

    const url =
        `${API_URL}?module=saveProfile`
        + `&email=${encodeURIComponent(user.email)}`
        + `&fullName=${encodeURIComponent(getVal("fullName"))}`
        + `&profession=${encodeURIComponent(getVal("profession"))}`
        + `&about=${encodeURIComponent(getVal("about"))}`
        + `&skills=${encodeURIComponent(getVal("skills"))}`
        + `&workLife=${encodeURIComponent(getVal("workLife"))}`;

    const res = await fetch(url);
    const result = await res.json();

    if (result.success) {
        localStorage.setItem("contact_user", JSON.stringify(result.user));
        alert("Profile updated");
        window.location.reload();
    } else {
        alert(result.message || "Failed to update profile");
    }
}

function getVal(id) {
    const el = document.getElementById(id);
    return el ? el.value : "";
}

/* CHANGE EMAIL */
async function changeEmail() {
    const user = JSON.parse(localStorage.getItem("contact_user"));
    const newEmail = getVal("newEmail").trim();

    const url = `${API_URL}?module=changeEmail&oldEmail=${encodeURIComponent(user.email)}&newEmail=${encodeURIComponent(newEmail)}`;
    const res = await fetch(url);
    const result = await res.json();

    if (result.success) {
        localStorage.setItem("contact_user", JSON.stringify(result.user));
        alert("Email updated");
        window.location.reload();
    } else {
        alert(result.message || "Failed to update email");
    }
}

/* CHANGE PASSWORD */
async function changePassword() {
    const user = JSON.parse(localStorage.getItem("contact_user"));
    const newPass = getVal("newPassword");
    const confirmPass = getVal("confirmPassword");

    if (newPass !== confirmPass) return alert("Passwords do not match");

    const url = `${API_URL}?module=changePassword&email=${encodeURIComponent(user.email)}&newPassword=${encodeURIComponent(newPass)}`;
    const res = await fetch(url);
    const result = await res.json();

    if (result.success) {
        alert("Password updated");
        localStorage.removeItem("contact_user");
        window.location.href = "login.html";
    } else {
        alert(result.message || "Failed to update password");
    }
}

/* LOGOUT */
function logout() {
    localStorage.removeItem("contact_user");
    window.location.href = "index.html";
}
</script>
</body>
</html>
